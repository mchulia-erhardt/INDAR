@startuml RASMIA - Modelo de Clases Principal

' Entidades principales del modelo de datos RASMIA
' Representa el núcleo de formularios y expedientes versionados

class Expediente {
  +id: Long
  +numeroExpediente: String
  +fechaAlta: DateTime
  +estado: String
  +versionBloqueada: Boolean
  --
  Referencias versionadas
  +tramiteVersionId: Long
  +formularioVersionId: Long
  +instalacionId: Long (opcional)
}

class TramiteVersion {
  +id: Long
  +tramiteDefId: Long
  +version: Integer
  +fechaActivacion: Date
  +fechaDesactivacion: Date
  +activo: Boolean
  +definicionJson: CLOB
}

class TramiteDef {
  +id: Long
  +codigo: String
  +nombre: String
  +descripcion: String
  +ambitoId: Long
}

class FormularioVersion {
  +id: Long
  +formularioDefId: Long
  +version: Integer
  +fechaActivacion: Date
  +fechaDesactivacion: Date
  +activo: Boolean
  +estructuraJson: CLOB
}

class FormularioDef {
  +id: Long
  +codigo: String
  +nombre: String
  +descripcion: String
}

class EntidadDef {
  +id: Long
  +formularioVersionId: Long
  +codigo: String
  +nombre: String
  +descripcion: String
  +multiple: Boolean
  +orden: Integer
}

class PropiedadDef {
  +id: Long
  +entidadDefId: Long
  +codigo: String
  +nombre: String
  +tipoDato: String
  +obligatorio: Boolean
  +orden: Integer
  +validacionesJson: CLOB
}

class Instalacion {
  +id: Long
  +codigoInstalacion: String
  +ubicacionId: Long
  +ambitoId: Long
  +fechaUltimaInspeccion: Date
  +fechaProximaInspeccion: Date
  +estadoActual: String
  +titularNif: String
  +titularNombre: String
}

class FormDataSnapshot {
  +id: Long
  +expedienteId: Long
  +tipo: String
  +datosJson: CLOB
  +fechaCaptura: DateTime
  +usuarioCaptura: String
  +hash: String
}

' Relaciones principales del modelo

TramiteDef "1" -- "0..*" TramiteVersion : define versiones >
FormularioDef "1" -- "0..*" FormularioVersion : define versiones >

Expediente "0..*" --> "1" TramiteVersion : utiliza versión
Expediente "0..*" --> "1" FormularioVersion : utiliza versión
Expediente "0..*" --> "0..1" Instalacion : asocia opcionalmente

FormularioVersion "1" -- "0..*" EntidadDef : contiene entidades >
EntidadDef "1" -- "0..*" PropiedadDef : contiene propiedades >

Expediente "1" -- "0..*" FormDataSnapshot : captura datos >

note right of Expediente
  Referencia versiones congeladas
  de Trámite y Formulario para
  garantizar estabilidad temporal
end note

note right of FormularioVersion
  Estructura congelada al activarse.
  EntidadDef y PropiedadDef quedan
  vinculadas a esta versión.
end note

note bottom of FormDataSnapshot
  Captura inmutable de datos
  aportados por el interesado
  (inicial, subsanación, cierre)
end note

@enduml
